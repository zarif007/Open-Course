import { SVGProps, useEffect, useRef, useState } from 'react';

type SafariMode = 'default' | 'simple';

export interface SafariProps extends SVGProps<SVGSVGElement> {
  url?: string;
  imageSrc?: string;
  videoSrc?: string;
  width?: number;
  height?: number;
  mode?: SafariMode;
}

export function Safari({
  imageSrc,
  videoSrc,
  url = 'example.com',
  width = 800,
  height = 500,
  mode = 'default',
  className = '',
  ...props
}: SafariProps) {
  const [isVisible, setIsVisible] = useState(false);
  const componentRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
        }
      },
      {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px',
      }
    );

    if (componentRef.current) {
      observer.observe(componentRef.current);
    }

    return () => {
      if (componentRef.current) {
        observer.unobserve(componentRef.current);
      }
    };
  }, []);

  return (
    <div
      ref={componentRef}
      className={`flex justify-center items-center w-full ${className} transition-all duration-1000 ease-out ${
        isVisible
          ? 'opacity-100 translate-y-0 scale-100'
          : 'opacity-0 translate-y-8 scale-95'
      }`}
    >
      <svg
        width="100%"
        height="100%"
        viewBox={`0 0 ${width} ${height}`}
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="max-w-full h-fit"
        style={{ aspectRatio: `${width}/${height}` }}
        {...props}
      >
        <g clipPath="url(#path0)">
          <path
            d="M0 35H800V494C800 498.418 796.418 502 792 502H8C3.58172 502 0 498.418 0 494V35Z"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M0 8C0 3.58172 3.58172 0 8 0H792C796.418 0 800 3.58172 800 8V35H0L0 8Z"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M0.711586 8C0.711586 3.94974 3.94974 0.666667 8 0.666667H792C796.05 0.666667 799.288 3.94974 799.288 8V34H0.711586V8Z"
            className="fill-white dark:fill-[#262626]"
          />
          <circle
            cx="18"
            cy="17"
            r="4"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <circle
            cx="31"
            cy="17"
            r="4"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <circle
            cx="44"
            cy="17"
            r="4"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <path
            d="M190 11C190 9.34315 191.343 8 193 8H630C631.657 8 633 9.34315 633 11V23C633 24.6569 631.657 26 630 26H193C191.343 26 190 24.6569 190 23V11Z"
            className="fill-[#E5E5E5] dark:fill-[#404040]"
          />
          <g className="mix-blend-luminosity">
            <path
              d="M377.513 21.3901H381.617C382.185 21.3901 382.464 21.1109 382.464 20.4932V17.3234C382.464 16.7647 382.235 16.4814 381.761 16.4347V15.3895C381.761 13.7814 380.691 13.0071 379.565 13.0071C378.439 13.0071 377.369 13.7814 377.369 15.3895V16.4473C376.929 16.5151 376.666 16.7942 376.666 17.3234V20.4932C376.666 21.1109 376.945 21.3901 377.513 21.3901ZM378.181 15.313C378.181 14.3272 378.806 13.7855 379.565 13.7855C380.319 13.7855 380.949 14.3272 380.949 15.313V16.4262L378.181 16.4305V15.313Z"
              fill="#A3A3A3"
            />
          </g>
          <g className="mix-blend-luminosity">
            <text
              x="387"
              y="20"
              fill="#A3A3A3"
              fontSize="8"
              fontFamily="Arial, sans-serif"
            >
              {url}
            </text>
          </g>
          {mode === 'default' ? (
            <>
              <g className="mix-blend-luminosity">
                <path
                  d="M177 22.5989C177.094 22.5989 177.235 22.5678 177.365 22.4898C180.365 20.8646 181.406 20.1094 181.406 18.2135V14.2813C181.406 13.6563 181.161 13.4323 180.641 13.2083C180.062 12.9635 178.12 12.2865 177.552 12.0938C177.38 12.0365 177.172 12 177 12C176.828 12 176.62 12.0469 176.448 12.0938C175.88 12.2552 173.938 12.9688 173.359 13.2083C172.839 13.4271 172.594 13.6563 172.594 14.2813V18.2135C172.594 20.1094 173.641 20.8542 176.635 22.4898C176.765 22.5678 176.906 22.5989 177 22.5989ZM177.281 13.0521C177.964 13.3177 179.448 13.8438 180.229 14.125C180.375 14.1771 180.411 14.2552 180.411 14.4427V17.6823C180.411 19.2083 179.646 19.625 177.297 21.375C177.151 21.4583 177.078 21.4896 177.005 21.4896V12.9896C177.078 12.9896 177.156 13.0104 177.281 13.0521Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M624.182 16.6511C624.333 16.6511 624.453 16.6042 624.547 16.5052L626.682 14.3542C626.797 14.2396 626.849 14.1146 626.849 13.9688C626.849 13.8281 626.792 13.6927 626.682 13.5885L624.547 11.4167C624.453 11.3125 624.333 11.2604 624.182 11.2604C623.901 11.2604 623.677 11.4948 623.677 11.7812C623.677 11.9219 623.724 12.0365 623.818 12.1354L625.063 13.3542C624.823 13.3177 624.568 13.2969 624.318 13.2969C621.739 13.2969 619.677 15.3594 619.677 17.9427C619.677 20.5260 621.755 22.6042 624.333 22.6042C626.917 22.6042 628.99 20.5260 628.99 17.9427C628.99 17.6302 628.771 17.4062 628.458 17.4062C628.156 17.4062 627.953 17.6302 627.953 17.9427C627.953 19.9531 626.344 21.5677 624.333 21.5677C622.328 21.5677 620.714 19.9531 620.714 17.9427C620.714 15.9167 622.313 14.3125 624.318 14.3125C624.656 14.3125 624.969 14.3385 625.245 14.3854L623.823 15.7917C623.724 15.8854 623.677 16 623.677 16.1406C623.677 16.4271 623.901 16.6511 624.182 16.6511Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M756 22.0104C756.327 22.0104 756.594 21.7396 756.594 21.4323V18.1719H759.773C760.087 18.1719 760.359 17.9062 760.359 17.5781C760.359 17.2552 760.087 16.9844 759.773 16.9844H756.594V13.7240C756.594 13.4115 756.327 13.1458 756 13.1458C755.68 13.1458 755.406 13.4115 755.406 13.7240V16.9844H752.227C751.92 16.9844 751.641 17.2552 751.641 17.5781C751.641 17.9062 751.92 18.1719 752.227 18.1719H755.406V21.4323C755.406 21.7396 755.68 22.0104 756 22.0104Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M774.533 20.7135H775.487V21.5833C775.487 22.7031 776.080 23.2812 777.207 23.2812H782.8C783.927 23.2812 784.513 22.7031 784.513 21.5885V16.0312C784.513 14.9167 783.927 14.3333 782.8 14.3333H781.847V13.5052C781.847 12.3906 781.253 11.8073 780.127 11.8073H774.533C773.4 11.8073 772.82 12.3854 772.82 13.5052V19.0104C772.82 20.1302 773.4 20.7135 774.533 20.7135ZM774.6 19.6719C774.12 19.6719 773.853 19.4219 773.853 18.9323V13.5885C773.853 13.0938 774.12 12.8438 774.6 12.8438H780.06C780.533 12.8438 780.8 13.0938 780.8 13.5885V14.3333H777.207C776.080 14.3333 775.487 14.9167 775.487 16.0312V19.6719H774.6ZM777.273 22.2448C776.793 22.2448 776.533 21.9948 776.533 21.4948V16.1250C776.533 15.6198 776.793 15.375 777.273 15.375H782.733C783.207 15.375 783.473 15.6198 783.473 16.1250V21.4948C783.473 21.9948 783.207 22.2448 782.733 22.2448H777.273Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M732.673 18.9427C732.940 18.9427 733.160 18.7240 733.160 18.4635V13.2240L733.120 12.4531L733.440 12.8333L734.167 13.6094C734.247 13.7031 734.373 13.75 734.493 13.75C734.733 13.75 734.933 13.5781 734.933 13.3333C734.933 13.2031 734.880 13.1094 734.793 13.0208L733.373 11.6719C733.253 11.5469 733.133 11.5052 732.673 11.5052C732.213 11.5052 732.093 11.5469 731.973 11.6719L730.553 13.0208C730.467 13.1094 730.413 13.2031 730.413 13.3333C730.413 13.5781 730.607 13.75 730.847 13.75C730.967 13.75 731.100 13.7031 731.180 13.6094L731.900 12.8333L732.227 12.4479L732.187 13.2240V18.4635C732.187 18.7240 732.407 18.9427 732.673 18.9427ZM730 23.1042H737.333C738.467 23.1042 739.047 22.5208 739.047 21.4062V16.2865C739.047 15.1719 738.467 14.5885 737.333 14.5885H735.927V15.625H737.267C737.740 15.625 738.013 15.875 738.013 16.375V21.3385C738.013 21.8125 737.740 22.0625 737.267 22.0625H730.067C729.587 22.0625 729.320 21.8125 729.320 21.3385V16.375C729.320 15.875 729.587 15.625 730.067 15.625H731.420V14.5885H730C728.873 14.5885 728.287 15.1667 728.287 16.2865V21.4062C728.287 22.5208 728.873 23.1042 730 23.1042Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M66.3802 22.4010H75.2917C76.4219 22.4010 777.010 21.8177 777.010 20.7031V14.3646C777.010 13.25 776.4219 12.6667 75.2917 12.6667H66.3802C65.2552 12.6667 64.6667 13.2448 64.6667 14.3646V20.7031C64.6667 21.8177 65.2552 22.4010 66.3802 22.4010ZM66.4479 21.3646C65.9688 21.3646 65.7031 21.1146 65.7031 20.6094V14.4583C65.7031 13.9531 65.9688 13.7031 66.4479 13.7031H68.8229V21.3646H66.4479ZM75.2240 13.7031C75.7031 13.7031 75.9688 13.9531 75.9688 14.4583V20.6094C75.9688 21.1146 75.7031 21.3646 75.2240 21.3646H69.8073V13.7031H75.2240ZM67.8021 15.6094C67.9896 15.6094 68.1458 15.4479 68.1458 15.2708C68.1458 15.0938 67.9896 14.9375 67.8021 14.9375H66.7344C66.5469 14.9375 66.3906 15.0938 66.3906 15.2708C66.3906 15.4479 66.5469 15.6094 66.7344 15.6094H67.8021ZM67.8021 17.0104C67.9896 17.0104 68.1458 16.8542 68.1458 16.6719C68.1458 16.4948 67.9896 16.3385 67.8021 16.3385H66.7344C66.5469 16.3385 66.3906 16.4948 66.3906 16.6719C66.3906 16.8542 66.5469 17.0104 66.7344 17.0104H67.8021ZM67.8021 18.4063C67.9896 18.4063 68.1458 18.2552 68.1458 18.0729C68.1458 17.8958 67.9896 17.7448 67.8021 17.7448H66.7344C66.5469 17.7448 66.3906 17.8958 66.3906 18.0729C66.3906 18.2552 66.5469 18.4063 66.7344 18.4063H67.8021Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M95.9427 21.7292C96.0625 21.8438 96.2083 21.9062 96.375 21.9062C96.7240 21.9062 96.9948 21.6354 96.9948 21.2917C96.9948 21.1198 96.9271 20.9635 96.8073 20.8438L93.1615 17.2812L96.8073 13.7292C96.9271 13.6094 96.9948 13.4479 96.9948 13.2812C96.9948 12.9375 96.7240 12.6667 96.375 12.6667C96.2083 12.6667 96.0625 12.7292 95.9479 12.8438L91.8958 16.8021C91.75 16.9375 91.6771 17.1042 91.6771 17.2865C91.6771 17.4688 91.75 17.625 91.8906 17.7656L95.9427 21.7292Z"
                  fill="#A3A3A3"
                />
              </g>
              <g className="mix-blend-luminosity">
                <path
                  d="M112.281 21.9062C112.453 21.9062 112.594 21.8438 112.714 21.7292L116.766 17.7708C116.906 17.625 116.979 17.4740 116.979 17.2865C116.979 17.1042 116.911 16.9427 116.766 16.8073L112.714 12.8438C112.594 12.7292 112.453 12.6667 112.281 12.6667C111.932 12.6667 111.661 12.9375 111.661 13.2812C111.661 13.4479 111.734 13.6094 111.849 13.7292L115.5 17.2917L111.849 20.8438C111.729 20.9688 111.661 21.1198 111.661 21.2917C111.661 21.6354 111.932 21.9062 112.281 21.9062Z"
                  fill="#A3A3A3"
                />
              </g>
            </>
          ) : null}
          {imageSrc && (
            <image
              href={imageSrc}
              x="1"
              y="35"
              width={width - 2}
              height={height - 36}
              preserveAspectRatio="xMidYMid slice"
              clipPath="url(#roundedBottom)"
            />
          )}
          {videoSrc && (
            <foreignObject
              x="1"
              y="35"
              width={width - 2}
              height={height - 36}
              preserveAspectRatio="xMidYMid slice"
              clipPath="url(#roundedBottom)"
            >
              <video
                className="size-full overflow-hidden object-cover"
                src={videoSrc}
                autoPlay
                loop
                muted
                playsInline
              />
            </foreignObject>
          )}
        </g>
        <defs>
          <clipPath id="path0">
            <rect width={width} height={height} fill="white" />
          </clipPath>
          <clipPath id="roundedBottom">
            <path
              d="M1 35H799V494C799 497.866 795.866 501 792 501H8C4.13401 501 1 497.866 1 494V35Z"
              fill="white"
            />
          </clipPath>
        </defs>
      </svg>
    </div>
  );
}
